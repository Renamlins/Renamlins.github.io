<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Lab de Física JS</title>
<style>
    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        background-color: #121212; /* Fundo mais escuro */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-family: 'Segoe UI', sans-serif;
        overflow: hidden;
        color: #888;
    }

    #canvas-container {
        /* Responsivo: 600px ou a largura da tela se for menor */
        width: 600px; 
        height: 600px;
        max-width: 90vw;
        max-height: 80vh;
        
        background: #000;
        border: 1px solid #333;
        box-shadow: 0 0 30px rgba(0,0,0,0.7); /* Glow leve */
        border-radius: 12px;
        position: relative;
        cursor: crosshair; /* Cursor de "mira" para indicar que pode clicar */
    }

    /* Instruções abaixo da caixa */
    .instructions {
        margin-top: 15px;
        font-size: 14px;
        opacity: 0.6;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
</head>
<body>

    <div id="canvas-container"></div>
    <div class="instructions">Arraste os objetos ou clique no vazio para criar caixas.</div>

<script>
window.addEventListener('load', function() {
    const { Engine, Render, Runner, Bodies, Composite, Mouse, MouseConstraint, Events, Common } = Matter;

    const container = document.getElementById("canvas-container");

    // Dimensões do laboratório
    let width = container.clientWidth;
    let height = container.clientHeight;

    // 1. ENGINE
    const engine = Engine.create();
    const world = engine.world;

    // 2. RENDER
    const render = Render.create({
        element: container,
        engine: engine,
        options: {
            width: width,
            height: height,
            pixelRatio: window.devicePixelRatio, // Nitidez em telas retina
            background: "#0a0a0a",
            wireframes: false
        }
    });

    Render.run(render);
    const runner = Runner.create();
    Runner.run(runner, engine);

    // 3. PAREDES (Limites do Laboratório)
    const wallThick = 100; // Grossura da parede (invisível fora da caixa)
    const walls = [
        Bodies.rectangle(width/2, -wallThick/2, width, wallThick, { isStatic: true }), // Teto
        Bodies.rectangle(width/2, height+wallThick/2, width, wallThick, { isStatic: true }), // Chão
        Bodies.rectangle(width+wallThick/2, height/2, wallThick, height, { isStatic: true }), // Direita
        Bodies.rectangle(-wallThick/2, height/2, wallThick, height, { isStatic: true }) // Esquerda
    ];
    Composite.add(world, walls);

    // 4. CRIAR OBJETOS INICIAIS
    function initShapes() {
        // Bolas coloridas
        for (let i = 0; i < 5; i++) {
            Composite.add(world, Bodies.circle(width/2 + (i-2)*40, 100, 20, {
                restitution: 0.9, 
                friction: 0.005,
                render: { fillStyle: "#4db5ff" }
            }));
        }

        // Frases (Blocos Retangulares)
        const labels = ["Physics JS", "Colisão", "Interatividade", "Arraste-me"];
        labels.forEach((txt, i) => {
            const w = txt.length * 12 + 40;
            const h = 40;
            const body = Bodies.rectangle(
                Math.random() * (width - 100) + 50, 
                Math.random() * 200, 
                w, h, 
                {
                    chamfer: { radius: 10 },
                    restitution: 0.6,
                    render: { fillStyle: "#333", strokeStyle: "#555", lineWidth: 1 }
                }
            );
            body.customLabel = txt;
            Composite.add(world, body);
        });
    }
    initShapes();

    // 5. INTERAÇÃO (MOUSE E TOQUE)
    const mouse = Mouse.create(render.canvas);
    const mouseConstraint = MouseConstraint.create(engine, {
        mouse: mouse,
        constraint: {
            stiffness: 0.2,
            render: { visible: false }
        }
    });
    Composite.add(world, mouseConstraint);
    render.mouse = mouse;

    // 6. FUNÇÃO DE DESENHO DE TEXTO
    Events.on(render, 'afterRender', function() {
        const ctx = render.context;
        ctx.font = "bold 14px Consolas, monospace"; // Fonte mais técnica/lab
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillStyle = "#fff";

        world.bodies.forEach(b => {
            if (b.customLabel) {
                ctx.save();
                ctx.translate(b.position.x, b.position.y);
                ctx.rotate(b.angle);
                ctx.fillText(b.customLabel, 0, 1);
                ctx.restore();
            }
        });
    });

    // 7. EVENTO EXTRA: CLIQUE PARA CRIAR CAIXAS
    Events.on(mouseConstraint, 'mousedown', function(event) {
        // Se o mouse não pegou nenhum corpo (clicou no vazio)
        if (!mouseConstraint.body) {
            const size = 30 + Math.random() * 20;
            const newBox = Bodies.rectangle(event.mouse.position.x, event.mouse.position.y, size, size, {
                restitution: 0.7,
                render: { fillStyle: `hsl(${Math.random() * 360}, 70%, 50%)` } // Cor aleatória
            });
            Composite.add(world, newBox);
        }
    });

    // 8. AUTO-REFRESH NO RESIZE
    // Como acordado, dá refresh na página para ajustar tudo se a tela mudar
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => location.reload(), 300);
    });

});
</script>

</body>
